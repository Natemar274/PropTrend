<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PropTrend</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script data-goatcounter="https://proptrend.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  <!-- Plotly.js CDN -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
  <style>
    /* ===== THEME SYSTEM (dark default) ===== */
    :root{
      --bg:#0b1220; --card-bg:#111a2e; --text:#e7eefc; --primary:#8cd4ff; --accent:#0c64ff; --tip-text:#9fb0cf; --border:#1a2744;
    }
    [data-theme="light"]{
      --bg:#f7f9ff; --card-bg:#ffffff; --text:#0b1220; --primary:#0c64ff; --accent:#1f77b4; --tip-text:#4a5d82; --border:#dbe3f7;
    }

    *{box-sizing:border-box}
    body{background:var(--bg); font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--text); margin:0; transition:background .25s ease,color .25s ease}

    /* Particle canvas */
    .particles{position:fixed; inset:0; z-index:0; pointer-events:none}

    /* Header */
    header{position:sticky; top:0; z-index:2; padding:12px 16px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, color-mix(in oklab, var(--card-bg) 88%, transparent), var(--bg)); backdrop-filter:saturate(120%) blur(6px)}
    .header-row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .header-title{font-size:1.25rem; font-weight:700; color:var(--primary); white-space:nowrap}
    .toolbar{display:flex; gap:10px; align-items:center}
    .spacer{flex:1}

    /* Buttons */
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:6px; background:color-mix(in oklab, var(--card-bg) 88%, var(--bg)); color:var(--text); border:1px solid var(--border); border-radius:8px; padding:10px 12px; cursor:pointer; text-decoration:none; font-weight:600; transition:filter .15s, transform .04s ease}
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:color-mix(in oklab, var(--primary) 28%, var(--card-bg))}

    /* Theme switch */
    .tog{display:inline-flex; gap:8px; align-items:center}
    .kbd{padding:2px 6px; border:1px solid var(--border); border-radius:4px; background:color-mix(in oklab, var(--card-bg) 80%, var(--bg)); font-size:12px; color:var(--tip-text)}
    .switch{position:relative; width:46px; height:26px; border-radius:999px; background:color-mix(in oklab, var(--card-bg) 80%, var(--bg)); border:1px solid var(--border)}
    .thumb{position:absolute; top:2px; left:2px; width:22px; height:22px; border-radius:50%; background:var(--text); transition:left .2s}
    [data-theme="light"] .thumb{left:22px}

    /* Cards */
    .card{background:var(--card-bg); border-radius:12px; padding:24px; margin:40px auto; box-shadow:0 8px 24px rgba(0,0,0,.25); max-width:95vw; width:95%; height:80vh; display:flex; justify-content:center; align-items:center; transition:transform .2s ease, box-shadow .2s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 12px 28px rgba(0,0,0,.35)}

    h2{font-size:1.5rem; font-weight:600; text-align:center; margin-top:30px}
    #last-updated{font-size:.8rem; color:var(--tip-text); text-align:center; padding:12px 0 0}

    /* Plotly backgrounds */
    .plot-paper-dark{background-color:#0b1220}
  </style>
  <script>
    (function(){
      const key='pt-theme';
      const saved=localStorage.getItem(key);
      document.documentElement.setAttribute('data-theme', (saved==='light'||saved==='dark')?saved:'dark');
      addEventListener('DOMContentLoaded', ()=>{
        const sw=document.getElementById('themeSwitch');
        if(!sw) return;
        const apply=mode=>{ document.documentElement.setAttribute('data-theme', mode); localStorage.setItem(key, mode); };
        sw.addEventListener('click', ()=>{
          const next = (document.documentElement.getAttribute('data-theme')==='dark')?'light':'dark';
          apply(next);
          // Re-render charts under new theme
          ['chart','yoyChart','momChart','cashRateChart'].forEach(id=>{ const el=document.getElementById(id); if(el && window.Plotly){ Plotly.purge(el);} });
          if(typeof renderAllCharts==='function') setTimeout(renderAllCharts, 10);
        });
      });
    })();
  </script>
</head>
<body>
<canvas id="particles" class="particles"></canvas>

<p id="last-updated" style="text-align: center; font-size: 0.95rem; padding: 12px 0 0;">
  Loading latest update...
</p>

<header>
  <div class="header-row">
    <div class="header-title">PropTrend</div>
    <div class="toolbar">
      <a href="index.html" class="btn primary">Home</a>
      <a href="simulator.html" class="btn">Simulator</a>
      <a href="about.html" class="btn">About</a>
      <div class="spacer"></div>
      <div class="tog" title="Theme">
        <span class="kbd">Dark</span>
        <div id="themeSwitch" class="switch"><div class="thumb"></div></div>
        <span class="kbd">Light</span>
      </div>
    </div>
  </div>
</header>
<p style="text-align: center; font-size: 0.9rem; max-width: 700px; margin: 12px auto 12px; color: var(--tip-text);">
  <em>Tip:</em> Click on city names in the legend to hide/show them. Click and drag across the chart to zoom in. Double-click to reset.
</p>

<!-- Chart containers -->
<div class="card">
  <div id="chart" style="width: 100%; height: 100%;"></div>
</div>
<div class="card">
  <div id="yoyChart" style="width: 100%; height: 100%;"></div>
</div>
<div class="card">
  <div id="momChart" style="width: 100%; height: 100%;"></div>
</div>
<div class="card">
  <div id="cashRateChart" style="width: 100%; height: 100%;"></div>
</div>

<script>
(function(){
  const cvs=document.getElementById('particles');
  if(!cvs) return;
  const ctx=cvs.getContext('2d'); let W=0,H=0, frame=0; const N=140; const parts=[];
  function resize(){ W=cvs.width=innerWidth*devicePixelRatio; H=cvs.height=innerHeight*devicePixelRatio; }
  addEventListener('resize', resize, {passive:true}); resize();
  for(let i=0;i<N;i++) parts.push({ x:Math.random()*W, y:Math.random()*H, r:Math.random()*1.8+0.4, vx:(Math.random()-0.5)*0.05*devicePixelRatio, vy:(Math.random()-0.5)*0.05*devicePixelRatio, a:Math.random()*360 });
  function step(){ frame++; ctx.clearRect(0,0,W,H); ctx.globalAlpha=0.85; ctx.fillStyle='#ffffff';
    for(const p of parts){ p.x+=p.vx; p.y+=p.vy; if(p.x<0)p.x+=W; if(p.x>W)p.x-=W; if(p.y<0)p.y+=H; if(p.y>H)p.y-=H; const t=0.75+0.25*Math.sin((frame+p.a)*0.02); ctx.beginPath(); ctx.arc(p.x,p.y,p.r*t,0,Math.PI*2); ctx.fill(); }
    requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
})();
</script>

<script>
  const chartDataStore = {};
</script>
<script>
  // Load combined JSON and store for rendering
  fetch('data_combined.json')
    .then(res => res.json())
    .then(data => {
      chartDataStore.main = data;
      // Use the last non-forecast (historical) data point for the "Last updated" message
      const lastDate = new Date(data.dates[data.dates.length - 61]);
      const formatted = `${lastDate.getDate().toString().padStart(2, '0')}/${(lastDate.getMonth() + 1).toString().padStart(2, '0')}/${lastDate.getFullYear()}`;
      document.getElementById('last-updated').innerHTML = `Last updated: <strong>${formatted}</strong>`;
      if (typeof renderAllCharts === 'function') renderAllCharts();
    })
    .catch(err => console.error('Error loading data:', err));
</script>


<script>
  // Load and store YoY chart data
  fetch('data_yoy.json')
    .then(res => res.json())
    .then(data => {
      chartDataStore.yoy = data;
      if (typeof renderAllCharts === 'function') renderAllCharts();
    });
</script>

<script>
  // Load and store MoM chart data
  fetch('data_mom.json')
    .then(res => res.json())
    .then(data => {
      chartDataStore.mom = data;
      if (typeof renderAllCharts === 'function') renderAllCharts();
    });
</script>

<script>
  // Load and store Cash Rate chart data
  fetch('cash_rate.json')
    .then(res => res.json())
    .then(data => {
      chartDataStore.cash = data;
      if (typeof renderAllCharts === 'function') renderAllCharts();
    });
</script>

<script>
function renderAllCharts() {
  const currentTheme = document.documentElement.dataset.theme || 'dark';
  const isDark = currentTheme === 'dark';
  const palette = ['#1f77b4','#ff7f0e','#2ca02c','#d62728','#9467bd','#8c564b','#e377c2','#7f7f7f'];

  if (chartDataStore.main) {
    const data = chartDataStore.main;
    const dates = data.dates.map(d => new Date(d));
    const cities = Object.keys(data).filter(k => k !== 'dates');
    const traces = [];
    const histPoints = data.dates.length - 60;

    cities.forEach((city, idx) => {
      const vals = data[city];
      const color = palette[idx % palette.length];

      traces.push({
        x: dates.slice(0, histPoints),
        y: vals.slice(0, histPoints),
        name: city,
        mode: 'lines',
        line: { dash: 'solid', width: 2, color },
        legendgroup: city,
        hoverinfo: 'x+y+name'
      });

      traces.push({
        x: dates.slice(histPoints),
        y: vals.slice(histPoints),
        name: city,
        mode: 'lines',
        line: { dash: 'dash', width: 2, color },
        legendgroup: city,
        showlegend: false,
        hoverinfo: 'x+y+name'
      });
    });

    const layout = {
      title: { text: 'Established Median House Prices â€“ Actual & Forecast' },
      paper_bgcolor: isDark ? '#111827' : '#ffffff',
      plot_bgcolor: isDark ? '#1f2937' : '#f9fafb',
      font: { color: isDark ? '#e5e7eb' : '#1f2937' },
      xaxis: {
        title: { text: 'Date' },
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      yaxis: {
        title: { text: 'Median Price (AUD)' },
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      hovermode: 'x unified',
      margin: { t: 50, l: 50, r: 30, b: 50 },
      autosize: true,
      annotations: [{
        text: 'PropTrend.com.au',
        xref: 'paper',
        yref: 'paper',
        x: 0.5,
        y: 0.5,
        showarrow: false,
        font: {
          size: 32,
          color: 'rgba(200,200,200,0.5)'
        },
        xanchor: 'center',
        yanchor: 'middle'
      }]
    };
    Plotly.newPlot('chart', traces, layout, { responsive: true });
  }

  if (chartDataStore.yoy) {
    const data = chartDataStore.yoy;
    const dates = data.map(d => d.Date);
    const cities = Object.keys(data[0]).filter(k => k !== 'Date');
    const traces = cities.map((city, idx) => ({
      x: dates,
      y: data.map(d => d[city]),
      name: city,
      mode: 'lines',
      line: { width: 2, color: palette[idx % palette.length] }
    }));
    const layout = {
      title: { text: 'Rolling 12-Month % Change' },
      paper_bgcolor: isDark ? '#111827' : '#ffffff',
      plot_bgcolor: isDark ? '#1f2937' : '#f9fafb',
      font: { color: isDark ? '#e5e7eb' : '#1f2937' },
      xaxis: {
        title: 'Date',
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      yaxis: {
        title: 'Annual % Change',
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      hovermode: 'x unified',
      margin: { t: 50, l: 50, r: 30, b: 50 },
      annotations: [{
        text: 'PropTrend.com.au',
        xref: 'paper',
        yref: 'paper',
        x: 0.5,
        y: 0.5,
        showarrow: false,
        font: {
          size: 32,
          color: 'rgba(200,200,200,0.5)'
        },
        xanchor: 'center',
        yanchor: 'middle'
      }]
    };
    Plotly.newPlot('yoyChart', traces, layout, { responsive: true });
  }

  if (chartDataStore.mom) {
    const data = chartDataStore.mom;
    const dates = data.map(d => d.Date);
    const cities = Object.keys(data[0]).filter(k => k !== 'Date');
    const traces = cities.map((city, idx) => ({
      x: dates,
      y: data.map(d => d[city]),
      name: city,
      mode: 'lines',
      line: { width: 2, color: palette[idx % palette.length] }
    }));
    const layout = {
      title: { text: 'Rolling Monthly % Change' },
      paper_bgcolor: isDark ? '#111827' : '#ffffff',
      plot_bgcolor: isDark ? '#1f2937' : '#f9fafb',
      font: { color: isDark ? '#e5e7eb' : '#1f2937' },
      xaxis: {
        title: 'Date',
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      yaxis: {
        title: 'Monthly % Change',
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      hovermode: 'x unified',
      margin: { t: 50, l: 50, r: 30, b: 50 },
      annotations: [{
        text: 'PropTrend.com.au',
        xref: 'paper',
        yref: 'paper',
        x: 0.5,
        y: 0.5,
        showarrow: false,
        font: {
          size: 32,
          color: 'rgba(200,200,200,0.5)'
        },
        xanchor: 'center',
        yanchor: 'middle'
      }]
    };
    Plotly.newPlot('momChart', traces, layout, { responsive: true });
  }

  if (chartDataStore.cash) {
    const data = chartDataStore.cash;
    const dates = data.map(d => d.Date);
    const rates = data.map(d => d["Cash Rate Target"]);
    const trace = {
      x: dates,
      y: rates,
      mode: 'lines+markers',
      name: 'Cash Rate',
      line: { width: 3, color: isDark ? '#60a5fa' : '#1f2937' }
    };
    const layout = {
      title: { text: 'RBA Cash Rate Over Time' },
      paper_bgcolor: isDark ? '#111827' : '#ffffff',
      plot_bgcolor: isDark ? '#1f2937' : '#f9fafb',
      font: { color: isDark ? '#e5e7eb' : '#1f2937' },
      xaxis: {
        title: 'Date',
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      yaxis: {
        title: 'Cash Rate (%)',
        gridcolor: isDark ? '#334155' : '#e2e8f0',
        linecolor: isDark ? '#e5e7eb' : '#1f2937',
        tickcolor: isDark ? '#e5e7eb' : '#1f2937'
      },
      hovermode: 'x unified',
      margin: { t: 50, l: 50, r: 30, b: 50 },
      annotations: [{
        text: 'PropTrend.com.au',
        xref: 'paper',
        yref: 'paper',
        x: 0.5,
        y: 0.5,
        showarrow: false,
        font: {
          size: 32,
          color: 'rgba(200,200,200,0.5)'
        },
        xanchor: 'center',
        yanchor: 'middle'
      }]
    };
    Plotly.newPlot('cashRateChart', [trace], layout, { responsive: true });
  }
}
</script>

</body>
</html>
